!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var o=e();for(var r in o)("object"==typeof exports?exports:t)[r]=o[r]}}(self,(function(){return function(){var t={677:function(t){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},t.exports.__esModule=!0,t.exports.default=t.exports},500:function(t,e,o){var r=o(659);function n(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,r(n.key),n)}}t.exports=function(t,e,o){return e&&n(t.prototype,e),o&&n(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t},t.exports.__esModule=!0,t.exports.default=t.exports},705:function(t,e,o){var r=o(659);t.exports=function(t,e,o){return(e=r(e))in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t},t.exports.__esModule=!0,t.exports.default=t.exports},810:function(t,e,o){var r=o(705);function n(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,r)}return o}t.exports=function(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?n(Object(o),!0).forEach((function(e){r(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):n(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t},t.exports.__esModule=!0,t.exports.default=t.exports},403:function(t,e,o){var r=o(984).default;t.exports=function(t,e){if("object"!==r(t)||null===t)return t;var o=t[Symbol.toPrimitive];if(void 0!==o){var n=o.call(t,e||"default");if("object"!==r(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)},t.exports.__esModule=!0,t.exports.default=t.exports},659:function(t,e,o){var r=o(984).default,n=o(403);t.exports=function(t){var e=n(t,"string");return"symbol"===r(e)?e:String(e)},t.exports.__esModule=!0,t.exports.default=t.exports},984:function(t){function e(o){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(o)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function o(r){var n=e[r];if(void 0!==n)return n.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,o),i.exports}o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,{a:e}),e},o.d=function(t,e){for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var r={};return function(){"use strict";o.r(r),o.d(r,{SafeMonitorSDK:function(){return M}});var t=o(810),e=o.n(t),n=o(677),i=o.n(n),a=o(500),l=o.n(a),u=o(705),p=o.n(u),s=o(984),f=o.n(s);function c(t){if("object"===f()(t)){var e=Array.isArray(t)?[]:{};for(var o in t)"object"==f()(t[o])?e[o]=c(t[o]):e[o]=t[o];return e}return t}var d=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return e.reduce((function(e,o){return e[o]=t[o],e}),{})},v=function(t){if(t.reason.config){var e=t.reason.config,o=e.url,r=e.method,n=e.params,i=void 0===n?"":n,a=e.data;return{requestUrl:o,method:r,params:i,data:m(void 0===a?"":a)}}},m=function(t){return"string"==typeof t&&((null==t?void 0:t.indexOf("{"))>-1||(null==t?void 0:t.indexOf("["))>-1)?JSON.parse(t):t},y=function(t){try{for(var e=(t||{}).href,o=(void 0===e?"":e).split("//")[1].split("/"),r=(o.length,[]),n=1;n<o.length;n++)r.push(o[n]);return r.join("/")}catch(e){return t.href}},g=[];function w(){return c(g)}function h(t){g.push(t)}function b(){g.length=0}var x={label:"JS异常",value:"js"},O={label:"异步报错",value:"async"},j={label:"静态资源加载异常",value:"res"},S={label:"promise异常",value:"promise"},D={label:"接口报错或超时",value:"request"},M=function(){function t(e,o){i()(this,t),p()(this,"url",void 0),p()(this,"option",void 0),p()(this,"report",void 0),p()(this,"lazyReportCache",void 0),p()(this,"duration",void 0),this.url=e,this.option=o,this.report=function(t,e){return function(o){var r=JSON.stringify({data:Array.isArray(o)?o:[o],platform:e.platform,productId:e.productId,userInfo:e.userInfo}),n=new Blob([r],{type:"application/json; charset=UTF-8"});if(window.navigator.sendBeacon)window.requestIdleCallback?window.requestIdleCallback((function(){navigator.sendBeacon(t,n)})):setTimeout((function(){navigator.sendBeacon(t,n)}));else{var i=new XMLHttpRequest;i.open("post",t),i.send(r)}}}(e,o),this.lazyReportCache=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3e3,o=null;return function(r){h(r),console.log(w()),o&&clearTimeout(o),o=window.setTimeout((function(){var e=w();e.length>0&&(t(e),b())}),e)}}(this.report,3e3),function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vue";if("jsp"===e){var o=0,r=0,n=0,i=function(){r=(new Date).getTime(),n=r-o,t({type:"duration",data:{platform:e,lastUrl:y(location),timestamp:(new Date).getTime(),logExtra:{timeSpent:n}}}),console.log("你停留在此页面的时间是："+n+"毫秒")};window.onload=function(){o=(new Date).getTime()},window.onbeforeunload=i}if("vue"===e){var a=(new Date).getTime();window.addEventListener("beforeunload",(function(){var o=(new Date).getTime()-a;t({type:"duration",data:{platform:e,lastUrl:y(location),timestamp:(new Date).getTime(),logExtra:{timeSpent:o}}});var r=w();r.length>0&&(t(r),b())}))}}(this.report,o.platform)}return l()(t,[{key:"reportClick",value:function(t){var e=this.option.platform,o={type:"click",data:{lastUrl:y(location),timestamp:(new Date).getTime(),platform:e,logExtra:t}};this.report(o)}},{key:"init",value:function(){var t,e;"jsp"===this.option.platform?(t=this.report,e=this.option.platform,t({type:"view",data:{timestamp:(new Date).getTime(),lastUrl:y(location),platform:e}})):"vue"===this.option.platform&&(this.report,this.option.routeType),this.initErrorMonitor(),this.initPerformanceMonitor()}},{key:"initErrorMonitor",value:function(){var t=this;window.onerror=function(e,o,r,n,i){var a=t.option.platform,l={type:"error",data:{lastUrl:y(location),timestamp:Date.now(),platform:a,logExtra:{msg:String(e),pageUrl:y(location),type:[x.value,O.value],time:Date.now(),agent:d(navigator,["appVersion"]),extra:{line:r,col:n}}}};console.info("【Monitor-SDK】window.onerror",l),t.report(l)},window.onunhandledrejection=function(e){var o={type:"error",data:{platform:t.option.platform,lastUrl:y(location),timestamp:Date.now(),logExtra:{msg:String(e.reason),pageUrl:y(location),type:[S.value,D.value],time:Date.now(),agent:d(navigator,["appVersion"]),extra:v(e)}}};console.info("【Monitor-SDK】window.onunhandledrejection",o),t.report(o)},window.addEventListener("error",(function(e){var o=e.message,r=e.colno,n=e.lineno,i={type:"error",data:{platform:t.option.platform,lastUrl:y(location),timestamp:Date.now(),logExtra:{msg:String(o),pageUrl:y(location),type:[O.value,x.value,j.value],time:Date.now(),agent:d(navigator,["appVersion"]),extra:{line:n,col:r}}}};console.info("【Monitor-SDK】window.addEventListener.error",i),t.report(i)}),!0)}},{key:"initPerformanceMonitor",value:function(){var t=XMLHttpRequest.prototype.open,o=XMLHttpRequest.prototype.send,r=this.lazyReportCache,n={},i=this.option.platform;XMLHttpRequest.prototype.open=function(e,o,r,i,a){return n[o.slice(0,o.indexOf("?"))]=e,t.call(this,e,o,r,i,a)},XMLHttpRequest.prototype.send=function(){for(var t=arguments.length,a=new Array(t),l=0;l<t;l++)a[l]=arguments[l];var u=Date.now();return this.addEventListener("loadend",(function(t){var o=t.target,l=m(a[0]),p=o,s=p.status,f=p.responseURL,c=f.slice("".concat(location.protocol,"//").concat(location.host).length,f.indexOf("?")>-1?f.indexOf("?"):f.length),d={type:"performance",data:{platform:i,lastUrl:y(location),timestamp:Date.now(),logExtra:{pageUrl:y(location),duration:Date.now()-u,time:Date.now(),payload:l,requestUrl:c,status:s,method:n[c]}}};console.info("【Monitor-SDK】window.performance",d),r(d),200!==s&&r(e()(e()({},JSON.parse(JSON.stringify(d))),{},{type:"error"}))})),o.call(this,a)}}}]),t}()}(),r}()}));